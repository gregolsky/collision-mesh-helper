$(function(){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var a=$("canvas.sprite"),b=$("input[name=scale]"),c=$("input[name=spriteFile]"),d=b.val(),e=[],f=null,g=function(a){if(e&&e.length){var b=e.slice();f&&b.push(f),a.fillStyle="rgba(255,0,0,0.5)",a.strokeStyle="rgba(255,10, 10, 0.5)";var c=b[0];a.beginPath(),a.moveTo(c.x,c.y);for(var d=1;d<b.length;d++){var g=b[d];a.lineTo(g.x,g.y)}a.closePath(),a.stroke(),a.fill(),a.strokeStyle="rgba(0, 200, 10, 0.7)",b.forEach(function(b){a.beginPath(),a.arc(b.x,b.y,.5,0,2*Math.PI,!1),a.stroke(),a.closePath()})}},h=function(b){var c=a[0].getContext("2d"),e=new Image;e.src=URL.createObjectURL(b),e.onload=function(){a.attr("width",e.width*d).attr("height",e.height*d),c.scale(d,d),c.clearRect(0,0,a[0].width,a[0].height),c.imageSmoothingEnabled=!1,c.ImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.drawImage(e,0,0),g(c)}},i=function(){var a=c[0].files.length?c[0].files[0]:null;a&&h(a)},j=function(a,b){var c=a.getBoundingClientRect(),d={x:b.clientX-c.left,y:b.clientY-c.top};return m(d)},k=function(){e.splice(0,e.length),$(".points").html(JSON.stringify(e)),d=5;var b=a[0].getContext("2d");b.clearRect(0,0,a[0].width,a[0].height)};c.change(function(){k(),i()}),b.on("input",function(){d=$(this).val(),i()}),$("button.reset").click(function(){return k(),!0});var l=function(a){return a/d},m=function(a){return{x:l(a.x),y:l(a.y)}},n=function(){var a=e.map(function(a){return[+a.x.toFixed(2),+a.y.toFixed(2)]}),b=a.reduce(function(a,b){return a.concat(b)});return JSON.stringify(b,null,2)},o=!1;a.mousedown(function(b){var c=j(a[0],b);f=c,o=!0}).mouseup(function(){e.push(f),o=!1,f=null,requestAnimationFrame(i),$(".points").html(n())}).mousemove(function(b){var c=j(a[0],b);o&&(f=c,requestAnimationFrame(i)),$(".currentCoords").html(c.x.toFixed(2)+", "+c.y.toFixed(2))})});